<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <title>jQuery</title>
    <link rel="stylesheet" href="../../common/css/reset.css" />
    <link rel="stylesheet" href="../../common/css/base.css" />
    <link rel="stylesheet" href="./css/style.css" />
  </head>
  <body>
    <div class="wrap">
      <div class="container">
        <div class="header">
          <p class="header__title">Search Books!</p>
        </div>
        <div class="search">
          <div class="search__text">
            <input
              type="text"
              class="search__text__input"
              placeholder="検索する"
              data-js="search-word"
            />
          </div>
          <button class="search__btn" data-js="search-btn">検索する</button>
        </div>
        <div class="message"></div>
        <ul class="lists"></ul>
      </div>
    </div>
    <script src="../../common/js/jquery.js"></script>
    <script>
      $(function () {
        var pageNum = 0;
        var countNum = 0;
        var ajaxData = function () {
          $.ajax({
            url:
              "https://app.rakuten.co.jp/services/api/BooksTotal/Search/20130522",
            type: "GET",
            datatype: "json",
            data: {
              applicationId: "1019399324990976605",
              booksGenreId: "001",
              hits: 20,
              page: pageNum,
              pageCount: countNum,
              count: "",
              keyword: searchWord,
            },
          }).done(function (data) {
            console.log(data);
            $(".pager").remove();
            $.each(data.Items, function (index, val) {
              $(".lists").append(
                '<li class="lists__item">' +
                  '<div class="lists__item__inner">' +
                  '<a href="' +
                  val.Item.itemUrl +
                  '" class="lists__item__link" target="_blank">' +
                  '<img src="' +
                  val.Item.largeImageUrl +
                  '" class="lists__item__img" alt="' +
                  val.Item.title +
                  '">' +
                  '<p class="lists__item__detail">作品名："' +
                  val.Item.title +
                  '"</p>' +
                  '<p class="lists__item__detail">作者　："' +
                  val.Item.author +
                  '"</p>' +
                  '<p class="lists__item__detail">出版社："' +
                  val.Item.publisherName +
                  '"</p>' +
                  "</a>" +
                  "</div>" +
                  "</li>"
              );
            });
            $("ul").after(
              '<div class="pager" data-js="pager">' +
                '<div class="counter">' +
                '<span class="counter-current"></span>' +
                data.page +
                "/" +
                data.pageCount +
                '<span class="counter-all"></span>' +
                "</div>" +
                '<div class="btn-wrapper">' +
                '<a class="btn-item" data-js="page-prev" href="#">前へ</a>' +
                '<a class="btn-item" data-js="page-next" href="#">次へ</a>' +
                "</div>" +
                "</div>"
            );
          });
        };
        $(".search__btn").on("click", function () {
          $("ul").empty();
          if(countNum === 1) {
            $('[data-js="page-prev"]').addClass(".disabled .btn-item");//両方隠す
            $('[data-js="page-next"]').addClass(".disabled .btn-item");
          }
          //addClass色々試してみる。 pageCountは変数で解決済み。
          else if(pageNum === 1) {
            $('[data-js="page-prev"]').addClass('.disabled');//前へを隠す
          }
          pageNum = 1;
          searchWord = $(".search__text__input").val();
          ajaxData();
        });
       
        $(document).on("click",'[data-js="page-next"]', function () {
          $("ul").empty();
          pageNum += 1;
          searchWord = $(".search__text__input").val();
          ajaxData();
        });

        
        //disableで最初のページ、最後のぺージ、検索結果が１ページの時’前へ次へ’を押せないように。
      });
    </script>
  </body>
</html>
